## CDN的缓存与回源机制解析

### 回顾

webpack优化文件=》图片优化=》缓存与本地存储

用起来



### ——CDN——

定义：

> CDN (Content Delivery Network，内容分发网络)指的是一组分布在各个地区的服务器。这些服务器存储着数据的副本，因此服务器可以根据哪些服务器与用户距离最近，来满足数据的请求。CDN提供快速服务，较少受高流量影响。

#### 为什么用？

提升首次请求的响应能力

#### CDN如何工作

🌰：

根服务器把内容推送到CDN节点=》根服务器在杭州，距离北京近的一个用户=》用户请求资源时，就近请求北京的服务器=》北京有，响应；北京没有，北京服务器向根服务器请求该资源

过程中北京服务器扮演着CDN的角色

#### CDN核心功能

一是缓存，二是回源。

缓存：把资源copy一分到CDN服务器的过程

回源：CDN发现自己没有资源（一般是缓存的数据过期了），向根服务器（或者它的上层服务器）去请求资源的过程

#### 关于性能优化的点

CDN往往用于存放静态资源（CSS、JS、图片等）。

业务服务器核心的任务在于生成动态页面或非纯静态页面，这两个过程都需要计算，仿佛一个车间；CDN相比之下类似一个仓库，只充当资源的”栖息地“和”搬运工“。

动态资源：后端实时动态生成的资源

非纯静态资源：指需要服务器在页面之外作额外计算的HTML页面，和业务服务器的操作耦合   骨架屏？

#### 实际应用

静态资源本身具有访问频率高、承接流量大的特点=》前端性能的一个关键指标=》CDN是静态资源提速的重要手段

#### 优化细节

涉及到CDN服务器本身的性能优化、CDN节点的地址选取等。

Cookie是紧跟域名的！！同一个域名下的请求会不分青红皂白地携带cookie，而静态资源往往不需要cookie携带什么认证信息。把资源和主页面放在两个不同的域名下，避免了不必要的cookie的传送。（用户体验、性能浪费、经济开销）



### 小结

服务端，网络，协议



#### 补充

CDN图片防盗？

纯静态页：OSS+CDN？CDN不是100%可靠，还要考虑CDN资源是否调用成功的判断，检查资源是否被修改？

静态资源分布在两个域上可以打破6个资源并发获取的限制（同时针对同一组{host,port}**最多允许打开6个HTTP和6个HTTPS连接**。可以进行更高程度的并发）浏览器的sockets套接字管理？

CDN是用户距离与相应时长和流量与节点的连接状况以及负载情况综合考虑的